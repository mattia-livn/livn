"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/analyze/route";
exports.ids = ["app/api/analyze/route"];
exports.modules = {

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "buffer":
/*!*************************!*\
  !*** external "buffer" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("buffer");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "events":
/*!*************************!*\
  !*** external "events" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("events");

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("fs");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

module.exports = require("https");

/***/ }),

/***/ "net":
/*!**********************!*\
  !*** external "net" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("net");

/***/ }),

/***/ "punycode":
/*!***************************!*\
  !*** external "punycode" ***!
  \***************************/
/***/ ((module) => {

module.exports = require("punycode");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("stream");

/***/ }),

/***/ "tls":
/*!**********************!*\
  !*** external "tls" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("tls");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("url");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("zlib");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fanalyze%2Froute&page=%2Fapi%2Fanalyze%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fanalyze%2Froute.ts&appDir=%2FUsers%2Fmattiapicca%2FDocuments%2Flivn%2Flivn%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fmattiapicca%2FDocuments%2Flivn%2Flivn&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!*************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fanalyze%2Froute&page=%2Fapi%2Fanalyze%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fanalyze%2Froute.ts&appDir=%2FUsers%2Fmattiapicca%2FDocuments%2Flivn%2Flivn%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fmattiapicca%2FDocuments%2Flivn%2Flivn&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \*************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _Users_mattiapicca_Documents_livn_livn_app_api_analyze_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/analyze/route.ts */ \"(rsc)/./app/api/analyze/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/analyze/route\",\n        pathname: \"/api/analyze\",\n        filename: \"route\",\n        bundlePath: \"app/api/analyze/route\"\n    },\n    resolvedPagePath: \"/Users/mattiapicca/Documents/livn/livn/app/api/analyze/route.ts\",\n    nextConfigOutput,\n    userland: _Users_mattiapicca_Documents_livn_livn_app_api_analyze_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/analyze/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZhbmFseXplJTJGcm91dGUmcGFnZT0lMkZhcGklMkZhbmFseXplJTJGcm91dGUmYXBwUGF0aHM9JnBhZ2VQYXRoPXByaXZhdGUtbmV4dC1hcHAtZGlyJTJGYXBpJTJGYW5hbHl6ZSUyRnJvdXRlLnRzJmFwcERpcj0lMkZVc2VycyUyRm1hdHRpYXBpY2NhJTJGRG9jdW1lbnRzJTJGbGl2biUyRmxpdm4lMkZhcHAmcGFnZUV4dGVuc2lvbnM9dHN4JnBhZ2VFeHRlbnNpb25zPXRzJnBhZ2VFeHRlbnNpb25zPWpzeCZwYWdlRXh0ZW5zaW9ucz1qcyZyb290RGlyPSUyRlVzZXJzJTJGbWF0dGlhcGljY2ElMkZEb2N1bWVudHMlMkZsaXZuJTJGbGl2biZpc0Rldj10cnVlJnRzY29uZmlnUGF0aD10c2NvbmZpZy5qc29uJmJhc2VQYXRoPSZhc3NldFByZWZpeD0mbmV4dENvbmZpZ091dHB1dD0mcHJlZmVycmVkUmVnaW9uPSZtaWRkbGV3YXJlQ29uZmlnPWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBQXNHO0FBQ3ZDO0FBQ2M7QUFDZTtBQUM1RjtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsZ0hBQW1CO0FBQzNDO0FBQ0EsY0FBYyx5RUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsWUFBWTtBQUNaLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxRQUFRLGlFQUFpRTtBQUN6RTtBQUNBO0FBQ0EsV0FBVyw0RUFBVztBQUN0QjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ3VIOztBQUV2SCIsInNvdXJjZXMiOlsid2VicGFjazovL2xpdm4taW11LWNhbGN1bGF0b3IvPzIwODQiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwUm91dGVSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1tb2R1bGVzL2FwcC1yb3V0ZS9tb2R1bGUuY29tcGlsZWRcIjtcbmltcG9ydCB7IFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBwYXRjaEZldGNoIGFzIF9wYXRjaEZldGNoIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvbGliL3BhdGNoLWZldGNoXCI7XG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiL1VzZXJzL21hdHRpYXBpY2NhL0RvY3VtZW50cy9saXZuL2xpdm4vYXBwL2FwaS9hbmFseXplL3JvdXRlLnRzXCI7XG4vLyBXZSBpbmplY3QgdGhlIG5leHRDb25maWdPdXRwdXQgaGVyZSBzbyB0aGF0IHdlIGNhbiB1c2UgdGhlbSBpbiB0aGUgcm91dGVcbi8vIG1vZHVsZS5cbmNvbnN0IG5leHRDb25maWdPdXRwdXQgPSBcIlwiXG5jb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBBcHBSb3V0ZVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5BUFBfUk9VVEUsXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9hbmFseXplL3JvdXRlXCIsXG4gICAgICAgIHBhdGhuYW1lOiBcIi9hcGkvYW5hbHl6ZVwiLFxuICAgICAgICBmaWxlbmFtZTogXCJyb3V0ZVwiLFxuICAgICAgICBidW5kbGVQYXRoOiBcImFwcC9hcGkvYW5hbHl6ZS9yb3V0ZVwiXG4gICAgfSxcbiAgICByZXNvbHZlZFBhZ2VQYXRoOiBcIi9Vc2Vycy9tYXR0aWFwaWNjYS9Eb2N1bWVudHMvbGl2bi9saXZuL2FwcC9hcGkvYW5hbHl6ZS9yb3V0ZS50c1wiLFxuICAgIG5leHRDb25maWdPdXRwdXQsXG4gICAgdXNlcmxhbmRcbn0pO1xuLy8gUHVsbCBvdXQgdGhlIGV4cG9ydHMgdGhhdCB3ZSBuZWVkIHRvIGV4cG9zZSBmcm9tIHRoZSBtb2R1bGUuIFRoaXMgc2hvdWxkXG4vLyBiZSBlbGltaW5hdGVkIHdoZW4gd2UndmUgbW92ZWQgdGhlIG90aGVyIHJvdXRlcyB0byB0aGUgbmV3IGZvcm1hdC4gVGhlc2Vcbi8vIGFyZSB1c2VkIHRvIGhvb2sgaW50byB0aGUgcm91dGUuXG5jb25zdCB7IHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzIH0gPSByb3V0ZU1vZHVsZTtcbmNvbnN0IG9yaWdpbmFsUGF0aG5hbWUgPSBcIi9hcGkvYW5hbHl6ZS9yb3V0ZVwiO1xuZnVuY3Rpb24gcGF0Y2hGZXRjaCgpIHtcbiAgICByZXR1cm4gX3BhdGNoRmV0Y2goe1xuICAgICAgICBzZXJ2ZXJIb29rcyxcbiAgICAgICAgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZVxuICAgIH0pO1xufVxuZXhwb3J0IHsgcm91dGVNb2R1bGUsIHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzLCBvcmlnaW5hbFBhdGhuYW1lLCBwYXRjaEZldGNoLCAgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXBwLXJvdXRlLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fanalyze%2Froute&page=%2Fapi%2Fanalyze%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fanalyze%2Froute.ts&appDir=%2FUsers%2Fmattiapicca%2FDocuments%2Flivn%2Flivn%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fmattiapicca%2FDocuments%2Flivn%2Flivn&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./app/api/analyze/route.ts":
/*!**********************************!*\
  !*** ./app/api/analyze/route.ts ***!
  \**********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/@supabase/supabase-js/dist/module/index.js\");\n\n\nasync function POST(request) {\n    try {\n        const formData = await request.formData();\n        const files = formData.getAll(\"files\");\n        if (!files || files.length === 0) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Nessun file da analizzare\"\n            }, {\n                status: 400\n            });\n        }\n        console.log(`üîç Analizzando ${files.length} documenti PDF...`);\n        const properties = [];\n        for (const file of files){\n            console.log(`üìÑ Analizzando: ${file.name}`);\n            try {\n                // Estrai il testo dal PDF\n                const arrayBuffer = await file.arrayBuffer();\n                const text = await extractTextFromPDF(arrayBuffer);\n                console.log(`üìù Testo estratto (${text.length} caratteri)`);\n                console.log(\"\\uD83D\\uDD0D Prime 500 caratteri del testo:\");\n                console.log(text.substring(0, 500));\n                console.log(\"\\uD83D\\uDD0D Ultime 500 caratteri del testo:\");\n                console.log(text.substring(Math.max(0, text.length - 500)));\n                if (text.length > 0) {\n                    // Analizza il testo con AI\n                    const extractedProperties = await analyzeTextWithAI(text, file.name);\n                    const enriched = await enrichPropertiesWithMunicipality(extractedProperties);\n                    properties.push(...enriched);\n                } else {\n                    console.log(\"‚ö†Ô∏è Nessun testo estratto dal PDF\");\n                    console.log(\"\\uD83D\\uDCCB Creando propriet\\xe0 vuota per inserimento manuale\");\n                    properties.push(createEmptyProperty(file.name));\n                }\n            } catch (error) {\n                console.error(`‚ùå Errore analisi ${file.name}:`, error);\n                // In caso di errore, crea una propriet√† vuota\n                properties.push(createEmptyProperty(file.name));\n            }\n        }\n        console.log(`‚úÖ Analisi completata: ${properties.length} immobili trovati`);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: true,\n            properties,\n            message: `Analizzati ${files.length} documenti, trovati ${properties.length} immobili`\n        });\n    } catch (error) {\n        console.error(\"Errore durante l'analisi:\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Errore durante l'analisi dei documenti\"\n        }, {\n            status: 500\n        });\n    }\n}\n// Estrae il testo dal PDF usando pdf-parse-new\nasync function extractTextFromPDF(arrayBuffer) {\n    try {\n        // Import dinamico di pdf-parse-new\n        const pdfParse = (await __webpack_require__.e(/*! import() */ \"vendor-chunks/pdf-parse-new\").then(__webpack_require__.t.bind(__webpack_require__, /*! pdf-parse-new */ \"(rsc)/./node_modules/pdf-parse-new/lib/pdf-parse.js\", 23))).default;\n        const buffer = Buffer.from(arrayBuffer);\n        const data = await pdfParse(buffer);\n        console.log(`üìÑ PDF info: ${data.numpages} pagine, ${data.text.length} caratteri`);\n        return data.text.trim();\n    } catch (error) {\n        console.error(\"Errore estrazione testo PDF:\", error);\n        return \"\";\n    }\n}\n// Analizza il testo estratto con OpenAI\nasync function analyzeTextWithAI(text, fileName) {\n    const openaiKey = process.env.OPENAI_API_KEY;\n    if (!openaiKey || openaiKey.includes(\"your_\")) {\n        console.log(\"‚ö†Ô∏è Chiave OpenAI non configurata, uso analisi pattern-based\");\n        return analyzeTextWithPatterns(text, fileName);\n    }\n    try {\n        console.log(\"\\uD83E\\uDD16 Chiamata OpenAI API...\");\n        const prompt = `\nAnalizza il seguente testo estratto da un documento catastale e identifica tutte le propriet√† immobiliari.\nPer ogni propriet√†, estrai:\n- Indirizzo completo\n- Comune e provincia (es. \"Alessandria (AL)\")\n- Categoria catastale (es. \"A/2\")\n- Rendita catastale in euro\n- Quota di possesso (es. \"1/2\" o \"1000/1000\" - converti in percentuale: 1/2 = 50%, 1000/1000 = 100%)\n- Superficie in metri quadri (se disponibile)\n- Numero di vani (se disponibile)\n- Foglio, particella e subalterno (se disponibili)\n\nIMPORTANTE:\n- NON inventare il codice comune catastale, estrai solo il nome del comune e la provincia.\n- La quota di possesso deve essere convertita in percentuale (es. 1/2 = 50%, 1/1 = 100%)\n- Per le categorie A (abitazioni) la consistenza √® in VANI\n- Per le categorie C (commerciali) la consistenza √® in METRI QUADRI\n\nRestituisci i dati in formato JSON array, dove ogni oggetto rappresenta una propriet√†.\nEsempio:\n[\n  {\n    \"address\": \"Via Roma 123\",\n    \"comune\": \"Alessandria\",\n    \"provincia\": \"AL\",\n    \"categoriaCatastale\": \"A/2\",\n    \"renditaCatastale\": 1000.00,\n    \"quotaPossesso\": 50,\n    \"superficie\": 85,\n    \"vani\": 4,\n    \"foglio\": \"123\",\n    \"particella\": \"456\",\n    \"subalterno\": \"1\"\n  }\n]\n\nTesto da analizzare:\n${text}\n`;\n        const response = await fetch(\"https://api.openai.com/v1/chat/completions\", {\n            method: \"POST\",\n            headers: {\n                \"Authorization\": `Bearer ${openaiKey}`,\n                \"Content-Type\": \"application/json\"\n            },\n            body: JSON.stringify({\n                model: \"gpt-3.5-turbo\",\n                messages: [\n                    {\n                        role: \"user\",\n                        content: prompt\n                    }\n                ],\n                temperature: 0.1,\n                max_tokens: 2000\n            })\n        });\n        if (!response.ok) {\n            const errorText = await response.text();\n            console.error(\"OpenAI API Error:\", response.status, errorText);\n            throw new Error(`API Error: ${response.status}`);\n        }\n        const data = await response.json();\n        const aiResponse = data.choices[0].message.content;\n        console.log(\"\\uD83E\\uDD16 Risposta OpenAI ricevuta\");\n        console.log(\"\\uD83D\\uDCCB Dati estratti da OpenAI:\", aiResponse);\n        // Parse della risposta JSON\n        const extractedData = JSON.parse(aiResponse);\n        // Converte in oggetti Property con mapping completo\n        return extractedData.map((item, index)=>{\n            const property = item;\n            // Converti quota possesso in percentuale\n            let quotaPercentuale = 100;\n            const quotaStr = property.quotaPossesso;\n            if (quotaStr) {\n                if (quotaStr.includes(\"/\")) {\n                    const [numeratore, denominatore] = quotaStr.split(\"/\").map((n)=>parseInt(n.trim()));\n                    if (denominatore > 0) {\n                        quotaPercentuale = Math.round(numeratore / denominatore * 100);\n                    }\n                } else if (!isNaN(Number(quotaStr))) {\n                    quotaPercentuale = Number(quotaStr);\n                }\n            }\n            // Ignora qualsiasi campo codiceComune restituito dall'AI\n            return {\n                id: generateId(),\n                address: property.address || `Immobile ${index + 1} da ${fileName}`,\n                comune: property.comune || \"\",\n                provincia: property.provincia || \"\",\n                codiceComune: \"\",\n                categoriaCatastale: property.categoriaCatastale || \"\",\n                renditaCatastale: Number(property.renditaCatastale) || 0,\n                quotaPossesso: quotaPercentuale,\n                superficie: Number(property.superficie) || undefined,\n                vani: Number(property.vani) || undefined,\n                abitazionePrincipale: false,\n                locato: false,\n                pertinenze: [],\n                foglio: property.foglio || undefined,\n                particella: property.particella || undefined,\n                subalterno: property.subalterno || undefined,\n                analisiCompleta: true,\n                datiMancanti: []\n            };\n        });\n    } catch (error) {\n        console.error(\"‚ùå Errore analisi OpenAI:\", error);\n        console.error(\"‚ùå Dettagli errore:\", error instanceof Error ? error.message : String(error));\n        return analyzeTextWithPatterns(text, fileName);\n    }\n}\n// Analisi basata su pattern regex (fallback)\nfunction analyzeTextWithPatterns(text, fileName) {\n    console.log(\"\\uD83D\\uDD0D Usando analisi pattern-based...\");\n    const properties = [];\n    // Pattern per trovare informazioni catastali\n    const patterns = {\n        comune: /(?:Comune|COMUNE)[\\s:]+([A-Z][A-Za-z\\s]+)/gi,\n        provincia: /\\(([A-Z]{2})\\)/g,\n        codiceComune: /(?:Codice|CODICE)[\\s:]*Comune[\\s:]*([A-Z]\\d{3})/gi,\n        categoria: /(A\\/\\d+|B\\/\\d+|C\\/\\d+|D\\/\\d+)/gi,\n        rendita: /(?:rendita|RENDITA)[\\s:]*‚Ç¨?\\s*(\\d+[.,]\\d+)/gi,\n        foglio: /(?:foglio|FOGLIO)[\\s:]*(\\d+)/gi,\n        particella: /(?:particella|PARTICELLA)[\\s:]*(\\d+)/gi,\n        subalterno: /(?:sub|SUB|subalterno|SUBALTERNO)[\\s:]*(\\d+)/gi\n    };\n    // Estrai i dati usando i pattern\n    const comuni = Array.from(text.matchAll(patterns.comune)).map((m)=>m[1].trim());\n    const province = Array.from(text.matchAll(patterns.provincia)).map((m)=>m[1]);\n    const codiciComune = Array.from(text.matchAll(patterns.codiceComune)).map((m)=>m[1]);\n    const categorie = Array.from(text.matchAll(patterns.categoria)).map((m)=>m[1]);\n    const rendite = Array.from(text.matchAll(patterns.rendita)).map((m)=>parseFloat(m[1].replace(\",\", \".\")));\n    // Crea propriet√† basate sui dati trovati\n    const numProperties = Math.max(categorie.length, rendite.length, 1);\n    for(let i = 0; i < numProperties; i++){\n        properties.push({\n            id: generateId(),\n            address: `Immobile ${i + 1} da ${fileName}`,\n            comune: comuni[i] || \"\",\n            provincia: province[i] || \"\",\n            codiceComune: codiciComune[i] || \"\",\n            categoriaCatastale: categorie[i] || \"\",\n            renditaCatastale: rendite[i] || 0,\n            quotaPossesso: 100,\n            superficie: undefined,\n            vani: undefined,\n            abitazionePrincipale: false,\n            locato: false,\n            pertinenze: [],\n            foglio: undefined,\n            particella: undefined,\n            subalterno: undefined,\n            analisiCompleta: false,\n            datiMancanti: []\n        });\n    }\n    return properties.length > 0 ? properties : [\n        createEmptyProperty(fileName)\n    ];\n}\n// Crea una propriet√† vuota da completare manualmente\nfunction createEmptyProperty(fileName) {\n    return {\n        id: generateId(),\n        address: `Immobile da ${fileName}`,\n        comune: \"\",\n        provincia: \"\",\n        codiceComune: \"\",\n        categoriaCatastale: \"\",\n        renditaCatastale: 0,\n        quotaPossesso: 100,\n        superficie: undefined,\n        vani: undefined,\n        abitazionePrincipale: false,\n        locato: false,\n        pertinenze: [],\n        foglio: undefined,\n        particella: undefined,\n        subalterno: undefined,\n        analisiCompleta: false,\n        datiMancanti: [\n            \"abitazionePrincipale\",\n            \"locato\",\n            \"comune\",\n            \"provincia\",\n            \"categoriaCatastale\",\n            \"renditaCatastale\"\n        ]\n    };\n}\nfunction generateId() {\n    return Math.random().toString(36).substr(2, 9);\n}\n// Funzione per normalizzare i nomi dei comuni (case-insensitive, rimuove spazi)\nfunction normalizeComune(str) {\n    return str.trim().toLowerCase().replace(/\\s+/g, \"\");\n}\n// Funzione di lookup su Supabase\nasync function getMunicipalityData(comune, provincia) {\n    const supabaseUrl = process.env.SUPABASE_URL;\n    const supabaseAnonKey = process.env.SUPABASE_ANON;\n    if (!supabaseUrl || !supabaseAnonKey) return null;\n    const supabase = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_1__.createClient)(supabaseUrl, supabaseAnonKey);\n    // Normalizza il nome del comune\n    const normalizedComune = normalizeComune(comune);\n    const { data, error } = await supabase.from(\"municipalities\").select(\"name, province, codice\").ilike(\"name\", normalizedComune).eq(\"province\", provincia.toUpperCase()).limit(1).single();\n    if (error || !data) return null;\n    return {\n        name: data.name,\n        province: data.province,\n        codiceComune: data.codice\n    };\n}\n// Dopo aver estratto le propriet√† dall'AI, aggiorna ogni propriet√† con i dati da municipalities\nasync function enrichPropertiesWithMunicipality(properties) {\n    const enriched = [];\n    for (const prop of properties){\n        if (prop.comune && prop.provincia) {\n            const municipality = await getMunicipalityData(prop.comune, prop.provincia);\n            if (municipality) {\n                enriched.push({\n                    ...prop,\n                    comune: municipality.name,\n                    provincia: municipality.province,\n                    codiceComune: municipality.codiceComune\n                });\n                continue;\n            }\n        }\n        enriched.push(prop);\n    }\n    return enriched;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Z0NBQWdDO0lBQ2hDLE1BQU1HLG1CQUFtQlQsZ0JBQWdCbkM7SUFDekMsTUFBTSxFQUFFakQsSUFBSSxFQUFFMUIsS0FBSyxFQUFFLEdBQUcsTUFBTXNILFNBQzNCN0YsSUFBSSxDQUFDLGtCQUNMK0YsTUFBTSxDQUFDLDBCQUNQQyxLQUFLLENBQUMsUUFBUUYsa0JBQ2RHLEVBQUUsQ0FBQyxZQUFZOUMsVUFBVStDLFdBQVcsSUFDcENDLEtBQUssQ0FBQyxHQUNOQyxNQUFNO0lBQ1QsSUFBSTdILFNBQVMsQ0FBQzBCLE1BQU0sT0FBTztJQUMzQixPQUFPO1FBQ0xwQixNQUFNb0IsS0FBS3BCLElBQUk7UUFDZjZGLFVBQVV6RSxLQUFLeUUsUUFBUTtRQUN2QnRCLGNBQWNuRCxLQUFLb0csTUFBTTtJQUMzQjtBQUNGO0FBRUEsZ0dBQWdHO0FBQ2hHLGVBQWU5RyxpQ0FBaUNaLFVBQWlCO0lBQy9ELE1BQU1XLFdBQVcsRUFBRTtJQUNuQixLQUFLLE1BQU1nSCxRQUFRM0gsV0FBWTtRQUM3QixJQUFJMkgsS0FBS3BELE1BQU0sSUFBSW9ELEtBQUtuRCxTQUFTLEVBQUU7WUFDakMsTUFBTW9ELGVBQWUsTUFBTWYsb0JBQW9CYyxLQUFLcEQsTUFBTSxFQUFFb0QsS0FBS25ELFNBQVM7WUFDMUUsSUFBSW9ELGNBQWM7Z0JBQ2hCakgsU0FBU0UsSUFBSSxDQUFDO29CQUNaLEdBQUc4RyxJQUFJO29CQUNQcEQsUUFBUXFELGFBQWExSCxJQUFJO29CQUN6QnNFLFdBQVdvRCxhQUFhN0IsUUFBUTtvQkFDaEN0QixjQUFjbUQsYUFBYW5ELFlBQVk7Z0JBQ3pDO2dCQUNBO1lBQ0Y7UUFDRjtRQUNBOUQsU0FBU0UsSUFBSSxDQUFDOEc7SUFDaEI7SUFDQSxPQUFPaEg7QUFDVCIsInNvdXJjZXMiOlsid2VicGFjazovL2xpdm4taW11LWNhbGN1bGF0b3IvLi9hcHAvYXBpL2FuYWx5emUvcm91dGUudHM/NDZiYiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0UmVxdWVzdCwgTmV4dFJlc3BvbnNlIH0gZnJvbSAnbmV4dC9zZXJ2ZXInXG5pbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tICdAc3VwYWJhc2Uvc3VwYWJhc2UtanMnXG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBQT1NUKHJlcXVlc3Q6IE5leHRSZXF1ZXN0KSB7XG4gIHRyeSB7XG4gICAgY29uc3QgZm9ybURhdGEgPSBhd2FpdCByZXF1ZXN0LmZvcm1EYXRhKClcbiAgICBjb25zdCBmaWxlcyA9IGZvcm1EYXRhLmdldEFsbCgnZmlsZXMnKSBhcyBGaWxlW11cbiAgICBcbiAgICBpZiAoIWZpbGVzIHx8IGZpbGVzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IGVycm9yOiAnTmVzc3VuIGZpbGUgZGEgYW5hbGl6emFyZScgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICApXG4gICAgfVxuICAgIFxuICAgIGNvbnNvbGUubG9nKGDwn5SNIEFuYWxpenphbmRvICR7ZmlsZXMubGVuZ3RofSBkb2N1bWVudGkgUERGLi4uYClcbiAgICBcbiAgICBjb25zdCBwcm9wZXJ0aWVzID0gW11cbiAgICBcbiAgICBmb3IgKGNvbnN0IGZpbGUgb2YgZmlsZXMpIHtcbiAgICAgIGNvbnNvbGUubG9nKGDwn5OEIEFuYWxpenphbmRvOiAke2ZpbGUubmFtZX1gKVxuICAgICAgXG4gICAgICB0cnkge1xuICAgICAgICAvLyBFc3RyYWkgaWwgdGVzdG8gZGFsIFBERlxuICAgICAgICBjb25zdCBhcnJheUJ1ZmZlciA9IGF3YWl0IGZpbGUuYXJyYXlCdWZmZXIoKVxuICAgICAgICBjb25zdCB0ZXh0ID0gYXdhaXQgZXh0cmFjdFRleHRGcm9tUERGKGFycmF5QnVmZmVyKVxuICAgICAgICBcbiAgICAgICAgY29uc29sZS5sb2coYPCfk50gVGVzdG8gZXN0cmF0dG8gKCR7dGV4dC5sZW5ndGh9IGNhcmF0dGVyaSlgKVxuICAgICAgICBjb25zb2xlLmxvZygn8J+UjSBQcmltZSA1MDAgY2FyYXR0ZXJpIGRlbCB0ZXN0bzonKVxuICAgICAgICBjb25zb2xlLmxvZyh0ZXh0LnN1YnN0cmluZygwLCA1MDApKVxuICAgICAgICBjb25zb2xlLmxvZygn8J+UjSBVbHRpbWUgNTAwIGNhcmF0dGVyaSBkZWwgdGVzdG86JylcbiAgICAgICAgY29uc29sZS5sb2codGV4dC5zdWJzdHJpbmcoTWF0aC5tYXgoMCwgdGV4dC5sZW5ndGggLSA1MDApKSlcbiAgICAgICAgXG4gICAgICAgIGlmICh0ZXh0Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAvLyBBbmFsaXp6YSBpbCB0ZXN0byBjb24gQUlcbiAgICAgICAgICBjb25zdCBleHRyYWN0ZWRQcm9wZXJ0aWVzID0gYXdhaXQgYW5hbHl6ZVRleHRXaXRoQUkodGV4dCwgZmlsZS5uYW1lKVxuICAgICAgICAgIGNvbnN0IGVucmljaGVkID0gYXdhaXQgZW5yaWNoUHJvcGVydGllc1dpdGhNdW5pY2lwYWxpdHkoZXh0cmFjdGVkUHJvcGVydGllcylcbiAgICAgICAgICBwcm9wZXJ0aWVzLnB1c2goLi4uZW5yaWNoZWQpXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29uc29sZS5sb2coJ+KaoO+4jyBOZXNzdW4gdGVzdG8gZXN0cmF0dG8gZGFsIFBERicpXG4gICAgICAgICAgY29uc29sZS5sb2coJ/Cfk4sgQ3JlYW5kbyBwcm9wcmlldMOgIHZ1b3RhIHBlciBpbnNlcmltZW50byBtYW51YWxlJylcbiAgICAgICAgICBwcm9wZXJ0aWVzLnB1c2goY3JlYXRlRW1wdHlQcm9wZXJ0eShmaWxlLm5hbWUpKVxuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihg4p2MIEVycm9yZSBhbmFsaXNpICR7ZmlsZS5uYW1lfTpgLCBlcnJvcilcbiAgICAgICAgXG4gICAgICAgIC8vIEluIGNhc28gZGkgZXJyb3JlLCBjcmVhIHVuYSBwcm9wcmlldMOgIHZ1b3RhXG4gICAgICAgIHByb3BlcnRpZXMucHVzaChjcmVhdGVFbXB0eVByb3BlcnR5KGZpbGUubmFtZSkpXG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIGNvbnNvbGUubG9nKGDinIUgQW5hbGlzaSBjb21wbGV0YXRhOiAke3Byb3BlcnRpZXMubGVuZ3RofSBpbW1vYmlsaSB0cm92YXRpYClcbiAgICBcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIHByb3BlcnRpZXMsXG4gICAgICBtZXNzYWdlOiBgQW5hbGl6emF0aSAke2ZpbGVzLmxlbmd0aH0gZG9jdW1lbnRpLCB0cm92YXRpICR7cHJvcGVydGllcy5sZW5ndGh9IGltbW9iaWxpYFxuICAgIH0pXG4gICAgXG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3JlIGR1cmFudGUgbFxcJ2FuYWxpc2k6JywgZXJyb3IpXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgeyBlcnJvcjogJ0Vycm9yZSBkdXJhbnRlIGxcXCdhbmFsaXNpIGRlaSBkb2N1bWVudGknIH0sXG4gICAgICB7IHN0YXR1czogNTAwIH1cbiAgICApXG4gIH1cbn1cblxuLy8gRXN0cmFlIGlsIHRlc3RvIGRhbCBQREYgdXNhbmRvIHBkZi1wYXJzZS1uZXdcbmFzeW5jIGZ1bmN0aW9uIGV4dHJhY3RUZXh0RnJvbVBERihhcnJheUJ1ZmZlcjogQXJyYXlCdWZmZXIpOiBQcm9taXNlPHN0cmluZz4ge1xuICB0cnkge1xuICAgIC8vIEltcG9ydCBkaW5hbWljbyBkaSBwZGYtcGFyc2UtbmV3XG4gICAgY29uc3QgcGRmUGFyc2UgPSAoYXdhaXQgaW1wb3J0KCdwZGYtcGFyc2UtbmV3JykpLmRlZmF1bHRcbiAgICBcbiAgICBjb25zdCBidWZmZXIgPSBCdWZmZXIuZnJvbShhcnJheUJ1ZmZlcilcbiAgICBjb25zdCBkYXRhID0gYXdhaXQgcGRmUGFyc2UoYnVmZmVyKVxuICAgIFxuICAgIGNvbnNvbGUubG9nKGDwn5OEIFBERiBpbmZvOiAke2RhdGEubnVtcGFnZXN9IHBhZ2luZSwgJHtkYXRhLnRleHQubGVuZ3RofSBjYXJhdHRlcmlgKVxuICAgIFxuICAgIHJldHVybiBkYXRhLnRleHQudHJpbSgpXG4gICAgXG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXJyb3JlIGVzdHJhemlvbmUgdGVzdG8gUERGOicsIGVycm9yKVxuICAgIHJldHVybiAnJ1xuICB9XG59XG5cbi8vIEFuYWxpenphIGlsIHRlc3RvIGVzdHJhdHRvIGNvbiBPcGVuQUlcbmFzeW5jIGZ1bmN0aW9uIGFuYWx5emVUZXh0V2l0aEFJKHRleHQ6IHN0cmluZywgZmlsZU5hbWU6IHN0cmluZykge1xuICBjb25zdCBvcGVuYWlLZXkgPSBwcm9jZXNzLmVudi5PUEVOQUlfQVBJX0tFWVxuICBcbiAgaWYgKCFvcGVuYWlLZXkgfHwgb3BlbmFpS2V5LmluY2x1ZGVzKCd5b3VyXycpKSB7XG4gICAgY29uc29sZS5sb2coJ+KaoO+4jyBDaGlhdmUgT3BlbkFJIG5vbiBjb25maWd1cmF0YSwgdXNvIGFuYWxpc2kgcGF0dGVybi1iYXNlZCcpXG4gICAgcmV0dXJuIGFuYWx5emVUZXh0V2l0aFBhdHRlcm5zKHRleHQsIGZpbGVOYW1lKVxuICB9XG4gIFxuICB0cnkge1xuICAgIGNvbnNvbGUubG9nKCfwn6SWIENoaWFtYXRhIE9wZW5BSSBBUEkuLi4nKVxuICAgIFxuICAgIGNvbnN0IHByb21wdCA9IGBcbkFuYWxpenphIGlsIHNlZ3VlbnRlIHRlc3RvIGVzdHJhdHRvIGRhIHVuIGRvY3VtZW50byBjYXRhc3RhbGUgZSBpZGVudGlmaWNhIHR1dHRlIGxlIHByb3ByaWV0w6AgaW1tb2JpbGlhcmkuXG5QZXIgb2duaSBwcm9wcmlldMOgLCBlc3RyYWk6XG4tIEluZGlyaXp6byBjb21wbGV0b1xuLSBDb211bmUgZSBwcm92aW5jaWEgKGVzLiBcIkFsZXNzYW5kcmlhIChBTClcIilcbi0gQ2F0ZWdvcmlhIGNhdGFzdGFsZSAoZXMuIFwiQS8yXCIpXG4tIFJlbmRpdGEgY2F0YXN0YWxlIGluIGV1cm9cbi0gUXVvdGEgZGkgcG9zc2Vzc28gKGVzLiBcIjEvMlwiIG8gXCIxMDAwLzEwMDBcIiAtIGNvbnZlcnRpIGluIHBlcmNlbnR1YWxlOiAxLzIgPSA1MCUsIDEwMDAvMTAwMCA9IDEwMCUpXG4tIFN1cGVyZmljaWUgaW4gbWV0cmkgcXVhZHJpIChzZSBkaXNwb25pYmlsZSlcbi0gTnVtZXJvIGRpIHZhbmkgKHNlIGRpc3BvbmliaWxlKVxuLSBGb2dsaW8sIHBhcnRpY2VsbGEgZSBzdWJhbHRlcm5vIChzZSBkaXNwb25pYmlsaSlcblxuSU1QT1JUQU5URTpcbi0gTk9OIGludmVudGFyZSBpbCBjb2RpY2UgY29tdW5lIGNhdGFzdGFsZSwgZXN0cmFpIHNvbG8gaWwgbm9tZSBkZWwgY29tdW5lIGUgbGEgcHJvdmluY2lhLlxuLSBMYSBxdW90YSBkaSBwb3NzZXNzbyBkZXZlIGVzc2VyZSBjb252ZXJ0aXRhIGluIHBlcmNlbnR1YWxlIChlcy4gMS8yID0gNTAlLCAxLzEgPSAxMDAlKVxuLSBQZXIgbGUgY2F0ZWdvcmllIEEgKGFiaXRhemlvbmkpIGxhIGNvbnNpc3RlbnphIMOoIGluIFZBTklcbi0gUGVyIGxlIGNhdGVnb3JpZSBDIChjb21tZXJjaWFsaSkgbGEgY29uc2lzdGVuemEgw6ggaW4gTUVUUkkgUVVBRFJJXG5cblJlc3RpdHVpc2NpIGkgZGF0aSBpbiBmb3JtYXRvIEpTT04gYXJyYXksIGRvdmUgb2duaSBvZ2dldHRvIHJhcHByZXNlbnRhIHVuYSBwcm9wcmlldMOgLlxuRXNlbXBpbzpcbltcbiAge1xuICAgIFwiYWRkcmVzc1wiOiBcIlZpYSBSb21hIDEyM1wiLFxuICAgIFwiY29tdW5lXCI6IFwiQWxlc3NhbmRyaWFcIixcbiAgICBcInByb3ZpbmNpYVwiOiBcIkFMXCIsXG4gICAgXCJjYXRlZ29yaWFDYXRhc3RhbGVcIjogXCJBLzJcIixcbiAgICBcInJlbmRpdGFDYXRhc3RhbGVcIjogMTAwMC4wMCxcbiAgICBcInF1b3RhUG9zc2Vzc29cIjogNTAsXG4gICAgXCJzdXBlcmZpY2llXCI6IDg1LFxuICAgIFwidmFuaVwiOiA0LFxuICAgIFwiZm9nbGlvXCI6IFwiMTIzXCIsXG4gICAgXCJwYXJ0aWNlbGxhXCI6IFwiNDU2XCIsXG4gICAgXCJzdWJhbHRlcm5vXCI6IFwiMVwiXG4gIH1cbl1cblxuVGVzdG8gZGEgYW5hbGl6emFyZTpcbiR7dGV4dH1cbmBcblxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goJ2h0dHBzOi8vYXBpLm9wZW5haS5jb20vdjEvY2hhdC9jb21wbGV0aW9ucycsIHtcbiAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgaGVhZGVyczoge1xuICAgICAgICAnQXV0aG9yaXphdGlvbic6IGBCZWFyZXIgJHtvcGVuYWlLZXl9YCxcbiAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJ1xuICAgICAgfSxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgbW9kZWw6ICdncHQtMy41LXR1cmJvJyxcbiAgICAgICAgbWVzc2FnZXM6IFt7IHJvbGU6ICd1c2VyJywgY29udGVudDogcHJvbXB0IH1dLFxuICAgICAgICB0ZW1wZXJhdHVyZTogMC4xLFxuICAgICAgICBtYXhfdG9rZW5zOiAyMDAwXG4gICAgICB9KVxuICAgIH0pXG4gICAgXG4gICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgY29uc3QgZXJyb3JUZXh0ID0gYXdhaXQgcmVzcG9uc2UudGV4dCgpXG4gICAgICBjb25zb2xlLmVycm9yKCdPcGVuQUkgQVBJIEVycm9yOicsIHJlc3BvbnNlLnN0YXR1cywgZXJyb3JUZXh0KVxuICAgICAgdGhyb3cgbmV3IEVycm9yKGBBUEkgRXJyb3I6ICR7cmVzcG9uc2Uuc3RhdHVzfWApXG4gICAgfVxuICAgIFxuICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKClcbiAgICBjb25zdCBhaVJlc3BvbnNlID0gZGF0YS5jaG9pY2VzWzBdLm1lc3NhZ2UuY29udGVudFxuICAgIFxuICAgIGNvbnNvbGUubG9nKCfwn6SWIFJpc3Bvc3RhIE9wZW5BSSByaWNldnV0YScpXG4gICAgY29uc29sZS5sb2coJ/Cfk4sgRGF0aSBlc3RyYXR0aSBkYSBPcGVuQUk6JywgYWlSZXNwb25zZSlcbiAgICBcbiAgICAvLyBQYXJzZSBkZWxsYSByaXNwb3N0YSBKU09OXG4gICAgY29uc3QgZXh0cmFjdGVkRGF0YSA9IEpTT04ucGFyc2UoYWlSZXNwb25zZSlcbiAgICBcbiAgICAvLyBDb252ZXJ0ZSBpbiBvZ2dldHRpIFByb3BlcnR5IGNvbiBtYXBwaW5nIGNvbXBsZXRvXG4gICAgcmV0dXJuIGV4dHJhY3RlZERhdGEubWFwKChpdGVtOiB1bmtub3duLCBpbmRleDogbnVtYmVyKSA9PiB7XG4gICAgICBjb25zdCBwcm9wZXJ0eSA9IGl0ZW0gYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj5cbiAgICAgIFxuICAgICAgLy8gQ29udmVydGkgcXVvdGEgcG9zc2Vzc28gaW4gcGVyY2VudHVhbGVcbiAgICAgIGxldCBxdW90YVBlcmNlbnR1YWxlID0gMTAwXG4gICAgICBjb25zdCBxdW90YVN0ciA9IHByb3BlcnR5LnF1b3RhUG9zc2Vzc28gYXMgc3RyaW5nXG4gICAgICBpZiAocXVvdGFTdHIpIHtcbiAgICAgICAgaWYgKHF1b3RhU3RyLmluY2x1ZGVzKCcvJykpIHtcbiAgICAgICAgICBjb25zdCBbbnVtZXJhdG9yZSwgZGVub21pbmF0b3JlXSA9IHF1b3RhU3RyLnNwbGl0KCcvJykubWFwKG4gPT4gcGFyc2VJbnQobi50cmltKCkpKVxuICAgICAgICAgIGlmIChkZW5vbWluYXRvcmUgPiAwKSB7XG4gICAgICAgICAgICBxdW90YVBlcmNlbnR1YWxlID0gTWF0aC5yb3VuZCgobnVtZXJhdG9yZSAvIGRlbm9taW5hdG9yZSkgKiAxMDApXG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKCFpc05hTihOdW1iZXIocXVvdGFTdHIpKSkge1xuICAgICAgICAgIHF1b3RhUGVyY2VudHVhbGUgPSBOdW1iZXIocXVvdGFTdHIpXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIC8vIElnbm9yYSBxdWFsc2lhc2kgY2FtcG8gY29kaWNlQ29tdW5lIHJlc3RpdHVpdG8gZGFsbCdBSVxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgaWQ6IGdlbmVyYXRlSWQoKSxcbiAgICAgICAgYWRkcmVzczogcHJvcGVydHkuYWRkcmVzcyBhcyBzdHJpbmcgfHwgYEltbW9iaWxlICR7aW5kZXggKyAxfSBkYSAke2ZpbGVOYW1lfWAsXG4gICAgICAgIGNvbXVuZTogcHJvcGVydHkuY29tdW5lIGFzIHN0cmluZyB8fCAnJyxcbiAgICAgICAgcHJvdmluY2lhOiBwcm9wZXJ0eS5wcm92aW5jaWEgYXMgc3RyaW5nIHx8ICcnLFxuICAgICAgICBjb2RpY2VDb211bmU6ICcnLCAvLyBTYXLDoCB2YWxvcml6emF0byBzb2xvIGRvcG8gaWwgbG9va3VwIHN1IFN1cGFiYXNlXG4gICAgICAgIGNhdGVnb3JpYUNhdGFzdGFsZTogcHJvcGVydHkuY2F0ZWdvcmlhQ2F0YXN0YWxlIGFzIHN0cmluZyB8fCAnJyxcbiAgICAgICAgcmVuZGl0YUNhdGFzdGFsZTogTnVtYmVyKHByb3BlcnR5LnJlbmRpdGFDYXRhc3RhbGUpIHx8IDAsXG4gICAgICAgIHF1b3RhUG9zc2Vzc286IHF1b3RhUGVyY2VudHVhbGUsXG4gICAgICAgIHN1cGVyZmljaWU6IE51bWJlcihwcm9wZXJ0eS5zdXBlcmZpY2llKSB8fCB1bmRlZmluZWQsXG4gICAgICAgIHZhbmk6IE51bWJlcihwcm9wZXJ0eS52YW5pKSB8fCB1bmRlZmluZWQsXG4gICAgICAgIGFiaXRhemlvbmVQcmluY2lwYWxlOiBmYWxzZSxcbiAgICAgICAgbG9jYXRvOiBmYWxzZSxcbiAgICAgICAgcGVydGluZW56ZTogW10sXG4gICAgICAgIGZvZ2xpbzogcHJvcGVydHkuZm9nbGlvIGFzIHN0cmluZyB8fCB1bmRlZmluZWQsXG4gICAgICAgIHBhcnRpY2VsbGE6IHByb3BlcnR5LnBhcnRpY2VsbGEgYXMgc3RyaW5nIHx8IHVuZGVmaW5lZCxcbiAgICAgICAgc3ViYWx0ZXJubzogcHJvcGVydHkuc3ViYWx0ZXJubyBhcyBzdHJpbmcgfHwgdW5kZWZpbmVkLFxuICAgICAgICBhbmFsaXNpQ29tcGxldGE6IHRydWUsXG4gICAgICAgIGRhdGlNYW5jYW50aTogW11cbiAgICAgIH1cbiAgICB9KVxuICAgIFxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvcmUgYW5hbGlzaSBPcGVuQUk6JywgZXJyb3IpXG4gICAgY29uc29sZS5lcnJvcign4p2MIERldHRhZ2xpIGVycm9yZTonLCBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6IFN0cmluZyhlcnJvcikpXG4gICAgcmV0dXJuIGFuYWx5emVUZXh0V2l0aFBhdHRlcm5zKHRleHQsIGZpbGVOYW1lKVxuICB9XG59XG5cbi8vIEFuYWxpc2kgYmFzYXRhIHN1IHBhdHRlcm4gcmVnZXggKGZhbGxiYWNrKVxuZnVuY3Rpb24gYW5hbHl6ZVRleHRXaXRoUGF0dGVybnModGV4dDogc3RyaW5nLCBmaWxlTmFtZTogc3RyaW5nKSB7XG4gIGNvbnNvbGUubG9nKCfwn5SNIFVzYW5kbyBhbmFsaXNpIHBhdHRlcm4tYmFzZWQuLi4nKVxuICBcbiAgY29uc3QgcHJvcGVydGllcyA9IFtdXG4gIFxuICAvLyBQYXR0ZXJuIHBlciB0cm92YXJlIGluZm9ybWF6aW9uaSBjYXRhc3RhbGlcbiAgY29uc3QgcGF0dGVybnMgPSB7XG4gICAgY29tdW5lOiAvKD86Q29tdW5lfENPTVVORSlbXFxzOl0rKFtBLVpdW0EtWmEtelxcc10rKS9naSxcbiAgICBwcm92aW5jaWE6IC9cXCgoW0EtWl17Mn0pXFwpL2csXG4gICAgY29kaWNlQ29tdW5lOiAvKD86Q29kaWNlfENPRElDRSlbXFxzOl0qQ29tdW5lW1xcczpdKihbQS1aXVxcZHszfSkvZ2ksXG4gICAgY2F0ZWdvcmlhOiAvKEFcXC9cXGQrfEJcXC9cXGQrfENcXC9cXGQrfERcXC9cXGQrKS9naSxcbiAgICByZW5kaXRhOiAvKD86cmVuZGl0YXxSRU5ESVRBKVtcXHM6XSrigqw/XFxzKihcXGQrWy4sXVxcZCspL2dpLFxuICAgIGZvZ2xpbzogLyg/OmZvZ2xpb3xGT0dMSU8pW1xcczpdKihcXGQrKS9naSxcbiAgICBwYXJ0aWNlbGxhOiAvKD86cGFydGljZWxsYXxQQVJUSUNFTExBKVtcXHM6XSooXFxkKykvZ2ksXG4gICAgc3ViYWx0ZXJubzogLyg/OnN1YnxTVUJ8c3ViYWx0ZXJub3xTVUJBTFRFUk5PKVtcXHM6XSooXFxkKykvZ2lcbiAgfVxuICBcbiAgLy8gRXN0cmFpIGkgZGF0aSB1c2FuZG8gaSBwYXR0ZXJuXG4gIGNvbnN0IGNvbXVuaSA9IEFycmF5LmZyb20odGV4dC5tYXRjaEFsbChwYXR0ZXJucy5jb211bmUpKS5tYXAobSA9PiBtWzFdLnRyaW0oKSlcbiAgY29uc3QgcHJvdmluY2UgPSBBcnJheS5mcm9tKHRleHQubWF0Y2hBbGwocGF0dGVybnMucHJvdmluY2lhKSkubWFwKG0gPT4gbVsxXSlcbiAgY29uc3QgY29kaWNpQ29tdW5lID0gQXJyYXkuZnJvbSh0ZXh0Lm1hdGNoQWxsKHBhdHRlcm5zLmNvZGljZUNvbXVuZSkpLm1hcChtID0+IG1bMV0pXG4gIGNvbnN0IGNhdGVnb3JpZSA9IEFycmF5LmZyb20odGV4dC5tYXRjaEFsbChwYXR0ZXJucy5jYXRlZ29yaWEpKS5tYXAobSA9PiBtWzFdKVxuICBjb25zdCByZW5kaXRlID0gQXJyYXkuZnJvbSh0ZXh0Lm1hdGNoQWxsKHBhdHRlcm5zLnJlbmRpdGEpKS5tYXAobSA9PiBwYXJzZUZsb2F0KG1bMV0ucmVwbGFjZSgnLCcsICcuJykpKVxuICBcbiAgLy8gQ3JlYSBwcm9wcmlldMOgIGJhc2F0ZSBzdWkgZGF0aSB0cm92YXRpXG4gIGNvbnN0IG51bVByb3BlcnRpZXMgPSBNYXRoLm1heChjYXRlZ29yaWUubGVuZ3RoLCByZW5kaXRlLmxlbmd0aCwgMSlcbiAgXG4gIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtUHJvcGVydGllczsgaSsrKSB7XG4gICAgcHJvcGVydGllcy5wdXNoKHtcbiAgICAgIGlkOiBnZW5lcmF0ZUlkKCksXG4gICAgICBhZGRyZXNzOiBgSW1tb2JpbGUgJHtpICsgMX0gZGEgJHtmaWxlTmFtZX1gLFxuICAgICAgY29tdW5lOiBjb211bmlbaV0gfHwgJycsXG4gICAgICBwcm92aW5jaWE6IHByb3ZpbmNlW2ldIHx8ICcnLFxuICAgICAgY29kaWNlQ29tdW5lOiBjb2RpY2lDb211bmVbaV0gfHwgJycsXG4gICAgICBjYXRlZ29yaWFDYXRhc3RhbGU6IGNhdGVnb3JpZVtpXSB8fCAnJyxcbiAgICAgIHJlbmRpdGFDYXRhc3RhbGU6IHJlbmRpdGVbaV0gfHwgMCxcbiAgICAgIHF1b3RhUG9zc2Vzc286IDEwMCwgLy8gRGVmYXVsdCAxMDAlXG4gICAgICBzdXBlcmZpY2llOiB1bmRlZmluZWQsXG4gICAgICB2YW5pOiB1bmRlZmluZWQsXG4gICAgICBhYml0YXppb25lUHJpbmNpcGFsZTogZmFsc2UsXG4gICAgICBsb2NhdG86IGZhbHNlLFxuICAgICAgcGVydGluZW56ZTogW10sXG4gICAgICBmb2dsaW86IHVuZGVmaW5lZCxcbiAgICAgIHBhcnRpY2VsbGE6IHVuZGVmaW5lZCxcbiAgICAgIHN1YmFsdGVybm86IHVuZGVmaW5lZCxcbiAgICAgIGFuYWxpc2lDb21wbGV0YTogZmFsc2UsXG4gICAgICBkYXRpTWFuY2FudGk6IFtdXG4gICAgfSlcbiAgfVxuICBcbiAgcmV0dXJuIHByb3BlcnRpZXMubGVuZ3RoID4gMCA/IHByb3BlcnRpZXMgOiBbY3JlYXRlRW1wdHlQcm9wZXJ0eShmaWxlTmFtZSldXG59XG5cbi8vIENyZWEgdW5hIHByb3ByaWV0w6AgdnVvdGEgZGEgY29tcGxldGFyZSBtYW51YWxtZW50ZVxuZnVuY3Rpb24gY3JlYXRlRW1wdHlQcm9wZXJ0eShmaWxlTmFtZTogc3RyaW5nKSB7XG4gIHJldHVybiB7XG4gICAgaWQ6IGdlbmVyYXRlSWQoKSxcbiAgICBhZGRyZXNzOiBgSW1tb2JpbGUgZGEgJHtmaWxlTmFtZX1gLFxuICAgIGNvbXVuZTogJycsXG4gICAgcHJvdmluY2lhOiAnJyxcbiAgICBjb2RpY2VDb211bmU6ICcnLFxuICAgIGNhdGVnb3JpYUNhdGFzdGFsZTogJycsXG4gICAgcmVuZGl0YUNhdGFzdGFsZTogMCxcbiAgICBxdW90YVBvc3Nlc3NvOiAxMDAsIC8vIERlZmF1bHQgMTAwJVxuICAgIHN1cGVyZmljaWU6IHVuZGVmaW5lZCxcbiAgICB2YW5pOiB1bmRlZmluZWQsXG4gICAgYWJpdGF6aW9uZVByaW5jaXBhbGU6IGZhbHNlLFxuICAgIGxvY2F0bzogZmFsc2UsXG4gICAgcGVydGluZW56ZTogW10sXG4gICAgZm9nbGlvOiB1bmRlZmluZWQsXG4gICAgcGFydGljZWxsYTogdW5kZWZpbmVkLFxuICAgIHN1YmFsdGVybm86IHVuZGVmaW5lZCxcbiAgICBhbmFsaXNpQ29tcGxldGE6IGZhbHNlLFxuICAgIGRhdGlNYW5jYW50aTogWydhYml0YXppb25lUHJpbmNpcGFsZScsICdsb2NhdG8nLCAnY29tdW5lJywgJ3Byb3ZpbmNpYScsICdjYXRlZ29yaWFDYXRhc3RhbGUnLCAncmVuZGl0YUNhdGFzdGFsZSddXG4gIH1cbn1cblxuZnVuY3Rpb24gZ2VuZXJhdGVJZCgpOiBzdHJpbmcge1xuICByZXR1cm4gTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyKDIsIDkpXG59XG5cbi8vIEZ1bnppb25lIHBlciBub3JtYWxpenphcmUgaSBub21pIGRlaSBjb211bmkgKGNhc2UtaW5zZW5zaXRpdmUsIHJpbXVvdmUgc3BhemkpXG5mdW5jdGlvbiBub3JtYWxpemVDb211bmUoc3RyOiBzdHJpbmcpIHtcbiAgcmV0dXJuIHN0ci50cmltKCkudG9Mb3dlckNhc2UoKS5yZXBsYWNlKC9cXHMrL2csICcnKVxufVxuXG4vLyBGdW56aW9uZSBkaSBsb29rdXAgc3UgU3VwYWJhc2VcbmFzeW5jIGZ1bmN0aW9uIGdldE11bmljaXBhbGl0eURhdGEoY29tdW5lOiBzdHJpbmcsIHByb3ZpbmNpYTogc3RyaW5nKSB7XG4gIGNvbnN0IHN1cGFiYXNlVXJsID0gcHJvY2Vzcy5lbnYuU1VQQUJBU0VfVVJMXG4gIGNvbnN0IHN1cGFiYXNlQW5vbktleSA9IHByb2Nlc3MuZW52LlNVUEFCQVNFX0FOT05cbiAgaWYgKCFzdXBhYmFzZVVybCB8fCAhc3VwYWJhc2VBbm9uS2V5KSByZXR1cm4gbnVsbFxuICBjb25zdCBzdXBhYmFzZSA9IGNyZWF0ZUNsaWVudChzdXBhYmFzZVVybCwgc3VwYWJhc2VBbm9uS2V5KVxuXG4gIC8vIE5vcm1hbGl6emEgaWwgbm9tZSBkZWwgY29tdW5lXG4gIGNvbnN0IG5vcm1hbGl6ZWRDb211bmUgPSBub3JtYWxpemVDb211bmUoY29tdW5lKVxuICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgIC5mcm9tKCdtdW5pY2lwYWxpdGllcycpXG4gICAgLnNlbGVjdCgnbmFtZSwgcHJvdmluY2UsIGNvZGljZScpXG4gICAgLmlsaWtlKCduYW1lJywgbm9ybWFsaXplZENvbXVuZSlcbiAgICAuZXEoJ3Byb3ZpbmNlJywgcHJvdmluY2lhLnRvVXBwZXJDYXNlKCkpXG4gICAgLmxpbWl0KDEpXG4gICAgLnNpbmdsZSgpXG4gIGlmIChlcnJvciB8fCAhZGF0YSkgcmV0dXJuIG51bGxcbiAgcmV0dXJuIHtcbiAgICBuYW1lOiBkYXRhLm5hbWUsXG4gICAgcHJvdmluY2U6IGRhdGEucHJvdmluY2UsXG4gICAgY29kaWNlQ29tdW5lOiBkYXRhLmNvZGljZVxuICB9XG59XG5cbi8vIERvcG8gYXZlciBlc3RyYXR0byBsZSBwcm9wcmlldMOgIGRhbGwnQUksIGFnZ2lvcm5hIG9nbmkgcHJvcHJpZXTDoCBjb24gaSBkYXRpIGRhIG11bmljaXBhbGl0aWVzXG5hc3luYyBmdW5jdGlvbiBlbnJpY2hQcm9wZXJ0aWVzV2l0aE11bmljaXBhbGl0eShwcm9wZXJ0aWVzOiBhbnlbXSkge1xuICBjb25zdCBlbnJpY2hlZCA9IFtdXG4gIGZvciAoY29uc3QgcHJvcCBvZiBwcm9wZXJ0aWVzKSB7XG4gICAgaWYgKHByb3AuY29tdW5lICYmIHByb3AucHJvdmluY2lhKSB7XG4gICAgICBjb25zdCBtdW5pY2lwYWxpdHkgPSBhd2FpdCBnZXRNdW5pY2lwYWxpdHlEYXRhKHByb3AuY29tdW5lLCBwcm9wLnByb3ZpbmNpYSlcbiAgICAgIGlmIChtdW5pY2lwYWxpdHkpIHtcbiAgICAgICAgZW5yaWNoZWQucHVzaCh7XG4gICAgICAgICAgLi4ucHJvcCxcbiAgICAgICAgICBjb211bmU6IG11bmljaXBhbGl0eS5uYW1lLFxuICAgICAgICAgIHByb3ZpbmNpYTogbXVuaWNpcGFsaXR5LnByb3ZpbmNlLFxuICAgICAgICAgIGNvZGljZUNvbXVuZTogbXVuaWNpcGFsaXR5LmNvZGljZUNvbXVuZVxuICAgICAgICB9KVxuICAgICAgICBjb250aW51ZVxuICAgICAgfVxuICAgIH1cbiAgICBlbnJpY2hlZC5wdXNoKHByb3ApXG4gIH1cbiAgcmV0dXJuIGVucmljaGVkXG59ICJdLCJuYW1lcyI6WyJOZXh0UmVzcG9uc2UiLCJjcmVhdGVDbGllbnQiLCJQT1NUIiwicmVxdWVzdCIsImZvcm1EYXRhIiwiZmlsZXMiLCJnZXRBbGwiLCJsZW5ndGgiLCJqc29uIiwiZXJyb3IiLCJzdGF0dXMiLCJjb25zb2xlIiwibG9nIiwicHJvcGVydGllcyIsImZpbGUiLCJuYW1lIiwiYXJyYXlCdWZmZXIiLCJ0ZXh0IiwiZXh0cmFjdFRleHRGcm9tUERGIiwic3Vic3RyaW5nIiwiTWF0aCIsIm1heCIsImV4dHJhY3RlZFByb3BlcnRpZXMiLCJhbmFseXplVGV4dFdpdGhBSSIsImVucmljaGVkIiwiZW5yaWNoUHJvcGVydGllc1dpdGhNdW5pY2lwYWxpdHkiLCJwdXNoIiwiY3JlYXRlRW1wdHlQcm9wZXJ0eSIsInN1Y2Nlc3MiLCJtZXNzYWdlIiwicGRmUGFyc2UiLCJkZWZhdWx0IiwiYnVmZmVyIiwiQnVmZmVyIiwiZnJvbSIsImRhdGEiLCJudW1wYWdlcyIsInRyaW0iLCJmaWxlTmFtZSIsIm9wZW5haUtleSIsInByb2Nlc3MiLCJlbnYiLCJPUEVOQUlfQVBJX0tFWSIsImluY2x1ZGVzIiwiYW5hbHl6ZVRleHRXaXRoUGF0dGVybnMiLCJwcm9tcHQiLCJyZXNwb25zZSIsImZldGNoIiwibWV0aG9kIiwiaGVhZGVycyIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwibW9kZWwiLCJtZXNzYWdlcyIsInJvbGUiLCJjb250ZW50IiwidGVtcGVyYXR1cmUiLCJtYXhfdG9rZW5zIiwib2siLCJlcnJvclRleHQiLCJFcnJvciIsImFpUmVzcG9uc2UiLCJjaG9pY2VzIiwiZXh0cmFjdGVkRGF0YSIsInBhcnNlIiwibWFwIiwiaXRlbSIsImluZGV4IiwicHJvcGVydHkiLCJxdW90YVBlcmNlbnR1YWxlIiwicXVvdGFTdHIiLCJxdW90YVBvc3Nlc3NvIiwibnVtZXJhdG9yZSIsImRlbm9taW5hdG9yZSIsInNwbGl0IiwibiIsInBhcnNlSW50Iiwicm91bmQiLCJpc05hTiIsIk51bWJlciIsImlkIiwiZ2VuZXJhdGVJZCIsImFkZHJlc3MiLCJjb211bmUiLCJwcm92aW5jaWEiLCJjb2RpY2VDb211bmUiLCJjYXRlZ29yaWFDYXRhc3RhbGUiLCJyZW5kaXRhQ2F0YXN0YWxlIiwic3VwZXJmaWNpZSIsInVuZGVmaW5lZCIsInZhbmkiLCJhYml0YXppb25lUHJpbmNpcGFsZSIsImxvY2F0byIsInBlcnRpbmVuemUiLCJmb2dsaW8iLCJwYXJ0aWNlbGxhIiwic3ViYWx0ZXJubyIsImFuYWxpc2lDb21wbGV0YSIsImRhdGlNYW5jYW50aSIsIlN0cmluZyIsInBhdHRlcm5zIiwiY2F0ZWdvcmlhIiwicmVuZGl0YSIsImNvbXVuaSIsIkFycmF5IiwibWF0Y2hBbGwiLCJtIiwicHJvdmluY2UiLCJjb2RpY2lDb211bmUiLCJjYXRlZ29yaWUiLCJyZW5kaXRlIiwicGFyc2VGbG9hdCIsInJlcGxhY2UiLCJudW1Qcm9wZXJ0aWVzIiwiaSIsInJhbmRvbSIsInRvU3RyaW5nIiwic3Vic3RyIiwibm9ybWFsaXplQ29tdW5lIiwic3RyIiwidG9Mb3dlckNhc2UiLCJnZXRNdW5pY2lwYWxpdHlEYXRhIiwic3VwYWJhc2VVcmwiLCJTVVBBQkFTRV9VUkwiLCJzdXBhYmFzZUFub25LZXkiLCJTVVBBQkFTRV9BTk9OIiwic3VwYWJhc2UiLCJub3JtYWxpemVkQ29tdW5lIiwic2VsZWN0IiwiaWxpa2UiLCJlcSIsInRvVXBwZXJDYXNlIiwibGltaXQiLCJzaW5nbGUiLCJjb2RpY2UiLCJwcm9wIiwibXVuaWNpcGFsaXR5Il0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./app/api/analyze/route.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/@supabase","vendor-chunks/tr46","vendor-chunks/whatwg-url","vendor-chunks/webidl-conversions"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fanalyze%2Froute&page=%2Fapi%2Fanalyze%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fanalyze%2Froute.ts&appDir=%2FUsers%2Fmattiapicca%2FDocuments%2Flivn%2Flivn%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fmattiapicca%2FDocuments%2Flivn%2Flivn&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();